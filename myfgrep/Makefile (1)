##
## @file Makefile
## Betriebsysteme myfgrep Makefile
## Beispiel 0
## @author Thomas M. Galla <galla@technikum-wien.at>
## @date 2014/12/14
##
## @version $Revision$
##
## @todo
##
## URL: $HeadURL$
##
## Last Modified: $Author$
##

##
## ------------------------------------------------------------- variables --
##

INSTALL_BIN_DIR := /usr/local/bin
INSTALL_MAN_DIR := /usr/local/man/man1
INSTALL_ETC_DIR := /usr/local/etc
INSTALL_LIB_DIR := /usr/local/lib
INSTALL_SRC_DIR := /usr/local/src
INSTALL_DOC_DIR := /var/www/html

CC=gcc52
AWK=awk

CFLAGS    += -Wall
CFLAGS    += -Werror
CFLAGS    += -Wformat-security
CFLAGS    += -Wswitch-enum
CFLAGS    += -Wundef
CFLAGS    += -Wshadow
CFLAGS    += -Wbad-function-cast
CFLAGS    += -Wcast-align
CFLAGS    += -Wwrite-strings
CFLAGS    += -Wsign-compare
CFLAGS    += -Waggregate-return
CFLAGS    += -Wstrict-prototypes
CFLAGS    += -Wmissing-prototypes
CFLAGS    += -Wmissing-declarations
CFLAGS    += -Wmissing-format-attribute
CFLAGS    += -Winline
CFLAGS    += -Wdisabled-optimization
CFLAGS    += -fno-common
CFLAGS    += -Wextra
CFLAGS    += -Wold-style-definition
CFLAGS    += -Wdeclaration-after-statement
CFLAGS    += -Wmissing-field-initializers

# Optimization flags and other flags
# -O3 will enable further warnings like warnings w.r.t. use of
# uninitialized variables
CFLAGS    += -O3 -g -pedantic -std=gnu11
LDLIBS    +=

CP=cp
CD=cd
MV=mv
GREP=grep
DOXYGEN=doxygen

EXCLUDE_PATTERN=footrulewidth

##
## ----------------------------------------------------------------- rules --
##

%.o : %.c
	$(CC) $(CFLAGS) -o $@ -c $<

##
## --------------------------------------------------------------- targets --
##

all: myfgrep

myfgrep: myfgrep.o utils.o
	$(CC) $(CFLAGS) -o $@ $^

clean:
	$(RM) *.o *~

distclean: clean
	$(RM) -rf myfgrep doc

doc: html pdf

html:
	$(DOXYGEN) doxygen.dcf

pdf: html
	$(CD) doc/pdf && \
		$(MV) refman.tex refman_save.tex && \
		$(GREP) -v $(EXCLUDE_PATTERN) refman_save.tex > refman.tex && \
		$(RM) refman_save.tex && \
		make && \
		$(MV) refman.pdf refman.save && \
		$(RM) *.pdf *.html *.tex *.aux *.sty *.log *.eps *.out *.ind *.idx \
		      *.ilg *.toc *.tps Makefile && \
		$(MV) refman.save refman.pdf

##
## ---------------------------------------------------------- dependencies --
##

myfgrep.o: myfgrep.c utils.h
utils.o: utils.c utils.h

##
## =================================================================== eof ==
##
